<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>洛阳机务段机车驾驶证管理系统</title>
    <link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/index.css">
</head>
<body>
<script>
    //上传图片
    function setCardPreview()
    {
        var cardInput=document.getElementById("cardInput");
        var cardPreview=document.getElementById("cardPreview");
        if(cardInput.files &&    cardInput.files[0])
        {
            //火狐下，直接设img属性
            cardPreview.style.display = 'block';
            cardPreview.style.width = '150px';
            cardPreview.style.height = '150px';
            //imgObjPreview.src = docObj.files[0].getAsDataURL();
            //火狐7以上版本不能用上面的getAsDataURL()方式获取，需要一下方式
            cardPreview.src = window.URL.createObjectURL(cardInput.files[0]);
        }
        else
        {
            //IE下，使用滤镜
            cardInput.select();
            var imgSrc = document.selection.createRange().text;
            var cardPic = document.getElementById("cardPic");
            //图片异常的捕捉，防止用户修改后缀来伪造图片
            try
            {
                cardPic.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";
                cardPic.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = imgSrc;
            }
            catch(e)
            {
                alert("您上传的图片格式不正确，请重新选择!");
                return false;
            }
            cardPreview.style.display = 'none';
            document.selection.empty();
        }
        return true;
    }
    function setPhotoPreview()
    {
        var photoInput=document.getElementById("photoInput");
        var photoPreview=document.getElementById("photoPreview");
        if(photoInput.files &&    photoInput.files[0])
        {
            //火狐下，直接设img属性
            photoPreview.style.display = 'block';
            photoPreview.style.width = '150px';
            photoPreview.style.height = '150px';
            //imgObjPreview.src = docObj.files[0].getAsDataURL();
            //火狐7以上版本不能用上面的getAsDataURL()方式获取，需要一下方式
            photoPreview.src = window.URL.createObjectURL(photoInput.files[0]);
        }
        else
        {
            //IE下，使用滤镜
            photoInput.select();
            var imgSrc = document.selection.createRange().text;
            var cardPic = document.getElementById("cardPic");
            //图片异常的捕捉，防止用户修改后缀来伪造图片
            try
            {
                cardPic.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";
                cardPic.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = imgSrc;
            }
            catch(e)
            {
                alert("您上传的图片格式不正确，请重新选择!");
                return false;
            }
            photoPreview.style.display = 'none';
            document.selection.empty();
        }
        return true;
    }


</script>
<div id="loadingPic">
    <p>正在连接,请稍候...</p>
</div>
<div class="navbar-fixed-top navbar-inverse">
    <div class="navbar-inner">
        <p class="welcome float">欢迎</p>
        <a href="#" class="floatR"><i class="icon-cog icon-white"></i></a>
        <p class="name floatR"></p>
    </div>
</div>
<div id="reasonContainer">
    <div id="reasonContent">
        <p>请选择驳回该申请的原因：</p>
        <div>
            <div>
                <input type="radio" id="short" name="reason" checked><label for="short">材料不齐全</label>
            </div>
            <div>
                <input type="radio" id="false" name="reason"/><label for="false">信息有误</label>
            </div>
        </div>
        <div class="rejectReasonDiv">
            <div><input type="checkbox" id="shortTable"/><label for="shortTable">缺少申请表</label></div>
            <div><input type="checkbox" id="shortProve"/><label for="shortProve">缺少驾驶证丢失证明</label></div>
            <div><input type="checkbox" id="shortPhy"/><label for="shortPhy">缺少体检报告</label></div>
        </div>
        <div>
            <button id="rejectReasonSubmit">确定</button>
            <button id="cancelReject">取消</button>
        </div>
    </div>
</div>
<div id="displayApplyContainer">

</div>

<div id="selectPC" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="selectPCLabel">请选择批次：</h3>
    </div>
    <div class="modal-body">
        <form action="" class="form-horizontal">
            <select name="year" id="year">

            </select>
            <div class="input-prepend input-append">
                <span class="add-on">年第</span>
                <select name="year" id="PCselect">

                </select>
                <span class="add-on">批</span>
            </div>
        </form>


    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
        <button class="btn btn-primary">提交</button>
    </div>
</div>
<div id="inputArchivesId" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-body">
        <form action="" class="form-horizontal">
            <fieldset>
                <legend>大名单中查无此人，请输入档案号：</legend>
                <label id="inputArchivesIdName"></label>
                <input id="inputArchivesIdInput" type="text" placeholder="请输入档案号：">
            </fieldset>
        </form>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary">提交</button>
    </div>
</div>

<div id="drInfo" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="drInfoLabel">填写人员信息</h3>
    </div>
    <div class="modal-body">
        <form action="" class="form-horizontal">
            <div class="control-group">
                <label class="control-label">工资号：</label>
                <input class="payId uneditable-input span2" disabled/>
            </div>
            <div class="control-group">
                <label class="control-label">档案号：</label>
                <input class="archivesId uneditable-input span2" disabled/>
            </div>
            <div class="control-group">
                <label class="control-label">姓名：</label>
                <input class="name uneditable-input span2" disabled/>
            </div>
            <div class="control-group">
                <label class="control-label">性别：</label>
                <input class="sex uneditable-input span2" disabled/>
            </div>
            <div class="control-group">
                <label class="control-label">部门：</label>
                <input class="department uneditable-input span2" disabled/>
            </div>
            <div class="control-group">
                <label class="control-label">身份证号：</label>
                <input class="cardId uneditable-input span3" disabled/>
            </div>
            <div class="control-group">
                <label class="control-label">出生日期：</label>
                <input class="birthDate uneditable-input span2" disabled/>
            </div>
            <div class="control-group">
                <label class="control-label">退休日期：</label>
                <input class="txrq uneditable-input span2" disabled/>
            </div>
            <div class="control-group">
                <label class="control-label">初次领证日期：</label>
                <input type="text" class="sjDateInput date span2"/>
            </div>
            <div class="control-group">
                <label class="control-label">准驾类型代码：</label>
                <input type="text" class="sjDriveCodeInput span2"/>
            </div>
            <div class="control-group">
                <label class="control-label">有效起始日期：</label>
                <input type="text" class="startDateInput date span2"/>
            </div>
            <div class="control-group">
                <label class="control-label">有效截止日期：</label>
                <input type="text" class="deadlineInput date span2" />
            </div>
        </form>


    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
        <button class="btn btn-primary">提交</button>
    </div>
</div>
<div id="bigContent">
    <div id="appendWindowContent">
        <div id="appendWindow">
            <p>找到了重名人员,请选择正确人员:</p>
            <div class="appendWindowArea">

            </div>
            <div class="appendButtonArea">
                <button class="submit">确定</button>
                <button class="cancel">取消</button>
            </div>
        </div>
    </div>
    <div id="leftContent">
        <ul id="buttonList">
        </ul>
    </div>
    <div id="rightContent">
        <div class="operateContent">
            <div class="jykUse" id="appendContainer">
                <ul id="appendBanner" class="nav nav-tabs">
                    <li id="dr" class="float"><a href="#drContent">人员调入<span class="redPoint"></span></a></li>
                    <li id="ts" class="float"><a href="#tsContent">人员提升</a></li>
                    <li id="quit" class="float"><a href="#quitContent">人员离职<span class="redPoint"></span></a></li>
                </ul>
                <div class="tab-content">
                    <div class="appendContent tab-pane" id="drContent">
                        <a href="Webshell://hello" class="float">同步数据库</a>
                        <table cellspacing="0" cellpadding="0" id="appendDRTable" class="table table-striped table-bordered table-condensed"></table>
                        <p></p>
                    </div>
                    <div class="levelUpContent tab-pane" id="tsContent">
                        <div class="buttonBanner">
                            <div class="float">
                                <p>上传报名名单表</p>
                                <a class="question" data-toggle="tooltip" title data-original-title="每一次提升司机，请先点击该页签，并在下方上传《》录入该批次人员信息">?</a>
                            </div>
                            <span>
                                <img src="../images/rightArrow.png" alt="">
                                <img src="../images/rightArrow.png" alt="">
                            </span>
                            <div class="float">
                                <p>考试通过</p>
                                <span class="question" data-toggle="tooltip" title data-original-title="考试结果下发后，请点击该页签，上传《》来标识通过考试的人员">?</span>
                            </div>
                            <div class="float">
                                <p>历史记录</p>
                                <span class="question" data-toggle="tooltip" title data-original-title="点此查阅过往批次通过情况">?</span>
                            </div>
                        </div>
                        <div class="uploadExcelContent content">
                            <form action="" class="form-horizontal">
                                <div class="control-group">
                                    <label style="width:auto;margin-left:210px" class="control-label" for="uploadExcel1">请先上传劳人科《具提升资格人员大名单》</label>
                                    <div class="controls">
                                        <input type="file" accept=" application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" id="uploadExcel1"/>
                                    </div>
                                </div>
                                <div class="control-group" id="hiddenUpload" style="visibility: hidden;">
                                    <label style="width:auto;margin-left:251px" class="control-label" for="uploadExcel">再上传《司机理论考试信息一览表》</label>
                                    <div class="controls">
                                        <input type="file" accept=" application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" id="uploadExcel"/>
                                    </div>
                                </div>
                            </form>

                            <div id="uploadContent"></div>
                            <button class="confirmUpload">上传信息</button>
                            <div class="progressBar">
                            <span class="floatR">
                                <span class="done"></span>
                                /
                                <span class="total"></span>
                            </span>
                            </div>
                        </div>
                        <div class="levelUpTableContent content">
                            <table cellspacing="0" cellpadding="0" id="appendTSTable" class="table table-bordered table-condensed"></table>
                            <div>
                                <input type="file" accept=" application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" id="uploadExcel2"/>
                                <div id="uploadContent2"></div>
                            </div>
                        </div>
                        <div class="checkWithPCContent content">
                            <div class="control-group">
                                <select id="checkWithPCSelect" multiple="multiple"></select>
                                <button class="btn">查询</button>
                            </div>
                            <p class="pcStatus"></p>
                            <table cellspacing="0" cellpadding="0" id="checkWithPCTable" class="table table-bordered table-condensed"></table>
                            <div id="checkWithPCPage">
                                <span class="prev">上一页</span>
                                <span>第</span>
                                <span class="cur"></span>
                                <span>页&nbsp;/</span>
                                <span>共</span>
                                <span class="total"></span>
                                <span>页</span>
                                <span class="next">下一页</span>
                            </div>
                        </div>
                    </div>
                    <div class="quitContent tab-pane" id="quitContent">
                        <table cellspacing="0" cellpadding="0" id="appendLZTable" class="table table-striped table-bordered table-condensed"></table>
                    </div>
                </div>

                <div id="appendPage">
                    <span class="prev">上一页</span>
                    <span>第</span>
                    <span class="cur"></span>
                    <span>页&nbsp;/</span>
                    <span>共</span>
                    <span class="total"></span>
                    <span>页</span>
                    <span class="next">下一页</span>
                </div>
            </div>
            <div class="jykUse cjUse" id="queryCardContainer">
                <div id="queryCardBanner">
                    <button id="queryCardButton">查询</button><button class="htmlToXls">生成Excel文件</button>
                </div>
                <div id="moreButtonBanner">
                    <button id="more" class="more">更多...</button>
                </div>
                <div id="querySelectBanner">
                    <div id="whatToDisplay">
                        <div id="controlArea">
                            <span>查看：</span>
                            <span><input type="radio" name="select" id="all"><label for="all">全选</label></span>
                            <span><input type="radio" name="select" id="allNo"><label for="allNo">全不选</label></span>
                        </div>
                        <div id="inputArea">

                        </div>
                    </div>
                    <div id="whatToSelect" class="marginTop20px">
                        <div>选取：</div>
                        <div id="selectArea">
                            <select name="column" id="column" class="marginTop20px">
                                <option value="payId">工资号</option>
                                <option value="archivesId">档案号</option>
                                <option value="age">年龄</option>
                                <option value="sjDate">司机初次领证日期</option>
                                <option value="sjRemark">司机批准文号</option>
                                <option value="sjDriveCode">司机准驾类型代码</option>
                                <option value="sjDriveType">司机准驾类型</option>
                                <option value="startDate">有效起始日期</option>
                                <option value="deadline">有效截止日期</option>
                                <option value="remainingDays">剩余天数</option>
                                <option value="status">证件状态</option>
                            </select>
                            <div id="selectTypeDiv" class="marginTop20px"></div>
                            <div id="valueDiv"></div>

                        </div>
                    </div>


                </div>
                <div id="queryCardContent">
                </div>
                <div id="cardPageContent">
                    <span class="home">首页</span>
                    <span class="prev">上一页</span>
                    <span>第</span>
                    <span class="cur"></span>
                    <span>页&nbsp;/</span>
                    <span>共</span>
                    <span class="total"></span>
                    <span>页</span>
                    <span class="next">下一页</span>
                    <span class="last">末页</span>
                    <span>转到：第</span>
                    <select name="selectPage" class="selectPage"></select>
                    <span>页</span>
                </div>
            </div>
            <div class="jykUse cjUse" id="dataContainer">
                <div id="dataBanner"></div>
                <div id="dataContent">
                    <table id="dataTable" cellpadding="0" cellspacing="0" class="table table-bordered table-condensed table-striped"></table>
                </div>
                <div id="dataPage">
                    <span class="prev">上一页</span>
                    <span>第</span>
                    <span class="cur"></span>
                    <span>页&nbsp;/</span>
                    <span>共</span>
                    <span class="total"></span>
                    <span>页</span>
                    <span class="next">下一页</span>
                </div>
            </div>
            <div class="jykUse cjUse" id="checkContainer">

                <div id="checkBanner">
                    <div class="float" id="exchangeApplyCheck">换证申请</div>
                    <div class="float" id="fixApplyCheck">补证申请</div>
                </div>
                <div id="checkContent">
                    <div id="exchangeApplyContent">
                        <div id="exchangeCheckContainer">
                            <table cellspacing="0" cellpadding="0" id="exchangeCheckTable">

                            </table>
                        </div>
                        <div id="exchangeApplyPage">
                            <span class="prev">上一页</span>
                            <span>第</span>
                            <span class="cur"></span>
                            <span>页&nbsp;/</span>
                            <span>共</span>
                            <span class="total"></span>
                            <span>页</span>
                            <span class="next">下一页</span>
                        </div>
                    </div>
                    <div id="fixApplyContent">
                        <div id="fixCheckContainer">
                            <table cellspacing="0" cellpadding="0" id="fixCheckTable">

                            </table>
                        </div>
                        <div id="fixApplyPage">
                            <span class="prev">上一页</span>
                            <span>第</span>
                            <span class="cur"></span>
                            <span>页&nbsp;/</span>
                            <span>共</span>
                            <span class="total"></span>
                            <span>页</span>
                            <span class="next">下一页</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="jykUse cjUse" id="alertContainer">
                <div id="alertBanner">
                    <p class="p1">以下为</p>
                    <div class="selectArea"></div>
                    <p class="p2"></p>
                </div>
                <div id="alertContent">
                        <div id="alertTableContainer">
                            <table cellspacing="0" cellpadding="0" id="alertTable">

                            </table>
                        </div>
                        <div id="alertPage">
                            <span class="prev">上一页</span>
                            <span>第</span>
                            <span class="cur"></span>
                            <span>页&nbsp;/</span>
                            <span>共</span>
                            <span class="total"></span>
                            <span>页</span>
                            <span class="next">下一页</span>
                        </div>
                </div>
            </div>
            <div class="cjUse" id="yearlyContainer">
                <div class="yearlyBanner">
                    <p class="tip float">请输入乘务员工资号：</p>
                    <input type="text" class="float queryInput">
                    <button class="queryButton float">查询</button>
                </div>
                <div class="queryInfoContent">
                    <div class="float queryPicInfo"><img src="" alt="" style="width: 100%;height: 200px"></div>
                    <div class="float queryInfo">
                        <div>
                            <p>工资号</p><div class="payId"></div>
                            <p>姓名</p><div class="name"></div>
                            <p>部门</p><div class="department"></div>
                        </div>
                        <div>
                            <p>有效起始</p><div class="startDate"></div>
                            <p>有效截止</p><div class="deadline"></div>
                        </div>
                        <div>
                            <p>体检结论</p><div class="phyTest"></div>
                            <p>年鉴时间</p><div class="yearlyCheckDate"><input type="text" class="yearlyCheckDateInput date"></div>
                        </div>
                    </div>
                    <div class="yearlyButtonBanner">
                        <button class="phyTestOk">体检合格</button>
                        <button class="phyTestNo">体检不合格</button>
                        <button class="yearlyCheck">年鉴</button>
                    </div>
                </div>
            </div>
            <div class="jykUse cjUse" id="giveOutContainer">
                <div id="giveOutBanner"></div>
                <div id="giveOutContent">
                    <table id="giveOutTable" cellpadding="0" cellspacing="0"></table>
                </div>
                <div id="giveOutPage">
                    <span class="prev">上一页</span>
                    <span>第</span>
                    <span class="cur"></span>
                    <span>页&nbsp;/</span>
                    <span>共</span>
                    <span class="total"></span>
                    <span>页</span>
                    <span class="next">下一页</span>
                </div>
            </div>
            <div class="jykUse" id="editContainer">
                <div id="editBanner">
                    <p class="tip float">请输入您要编辑信息的乘务员的工资号：</p>
                    <input type="text" class="float queryInput">
                    <button class="queryButton float">查询</button>
                </div>

                <div class="queryInfoContent">
                    <div class="float queryPicInfo"><img src="" alt="" style="width: 100%;height: 200px"></div>
                    <div class="float queryInfo">
                        <div>
                            <p>工资号</p><div class="payId"><input type="text" class="payIdInput"></div>
                            <p>姓名</p><div class="name"></div>
                            <p>部门</p><div class="department"></div>
                        </div>
                        <div>
                            <p>出生日期</p><div class="birth date"></div>
                            <p>司机领证日期</p><div class="sjDate"><input type="text" class="sjDateInput date"></div>
                        </div>
                        <div>
                            <p>批准文号</p><div class="sjRemark"><input type="text" class="sjRemarkInput"></div>

                            <p>年鉴时间</p><div class="yearlyCheckDate"><input type="text" class="yearlyCheckDateInput date"></div>
                        </div>
                        <div>
                            <p>准驾类型代码</p><div class="driveCode"><input type="text" class="driveCodeInput"></div>
                            <p>准驾机型</p><div class="driveType"><input type="text" class="driveTypeInput"></div>
                        </div>
                        <div>
                            <p>有效起始</p><div class="startDate"><input type="text" class="startDateInput date"></div>
                            <p>有效截止</p><div class="deadline"><input type="text" class="deadlineInput date"></div>
                        </div>
                        <div>
                            <p>体检结论</p><div class="phyTest"></div>
                        </div>
                    </div>
                </div>
                <div class="editButtonBanner">
                    <button class="cjEdit">车间转调</button>
                    <button class="rydc">人员调出</button>
                    <button class="logout">证件注销</button>
                    <button class="infoFix">信息更正</button>
                    <button class="phyTestOk">体检合格</button>
                    <button class="phyTestNo">体检不合格</button>
                </div>
                <div class="textContent">
                    <span>请选择</span>
                    <span class="name"></span>
                    <span>师傅的转调去向：</span>
                    <select name="" id="editFixSelect"></select>
                </div>
                <div class="logOutContent">
                    <span>请选择注销该证件的原因：</span>
                    <select name="" id="logOutReason"></select>
                </div>
            </div>
            <div class="jykUse" id="summaryContainer">
                <div class="summaryBanner">
                    <p>请选择您要查看的汇总信息:</p>
                    <select name="" id="summarySelect"></select>
                    <button class="htmlToXls">导出EXCEL</button>
                </div>
                <div class="summaryContent">
                    <table cellspacing="0" cellpadding="0" id="summaryTable"></table>
                </div>
                <div id="summaryPage">
                    <span class="prev">上一页</span>
                    <span>第</span>
                    <span class="cur"></span>
                    <span>页&nbsp;/</span>
                    <span>共</span>
                    <span class="total"></span>
                    <span>页</span>
                    <span class="next">下一页</span>
                </div>
            </div>
            <div class="sjUse" id="informationContainer">
                <div id="cardPicContent">
                    <img src="" alt="" style="width: 100%;height: 200px">
                </div>
                <div id="cardInfoContent">
                    <p>姓名</p><div class="name">xxx</div>
                    <p>出生日期</p><div class="birth"></div>
                    <p>身份证号</p><div class="idCard"></div><p>准驾机型</p><div class="driveType">xx</div>
                    <p>有效起始</p><div class="startDate">xxxx-xx-xx</div><p>有效截止</p><div class="deadline">xxxx-xx-xx</div>
                    <p>初次领证日期</p><div class="sjDate">xxxx-xx-xx</div><p>年鉴时间</p><div class="yearlyCheckDate">xxxx-xx-xx</div>
                </div>
            </div>
            <div class="sjUse" id="applyContainer">
                <button id="fixButton">驾驶证不慎遗失，申请补证</button>
                <button id="yxqmButton">驾驶证有效期将满，申请换证</button>
                <button id="fyxqmButton">其他原因需要换证</button>
                <div id="fixTable">
                    <h1>铁路机车车辆驾驶证换（补）证申请表 </h1>
                    <div id="fixTableArea" class="borderAll">
                        <div class="borderAll">
                            <div class="float width572">
                                <div class="float width68 height35 borderBottom borderRight textCenter">姓名</div>
                                <div id="nameInTable" class="float width503 height35 borderBottom textCenter"></div>
                                <div class="float width68 height35 borderRight textCenter">性别</div>
                                <div id="sexInTable" class="float width125 height35 textCenter borderRight" style="width: 128px"></div>
                                <div class="width125 height35 borderRight float textCenter" style="width: 124px">出生日期</div>
                                <div class="width249 height35 float textCenter">
                                    <span id="birthYearInTable" class="height35"></span>年
                                    <span id="birthMonthInTable" class="height35"></span>月
                                    <span id="birthDateInTable" class="height35"></span>日
                                </div>
                                <div class="width572 float borderTop">
                                    <div class="width122 height35 float">公民身份号码</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                    <div class="cardIdInTable borderLeft width24 height35 float">1</div>
                                </div>
                                <div class="width572 borderTop float">
                                    <div class="width122 float height35">固定电话</div>
                                    <div class="width174 borderLeft float height35">
                                        <div class="width174 height35 noborder" id="fixedPhoneInTable"></div>
                                    </div>
                                    <div class="width99 borderLeft float height35 textCenter">移动电话</div>
                                    <div class="width174 borderLeft float height35">
                                        <div class="width174 height35 noborder" id="mobilePhoneInTable"></div>
                                    </div>
                                </div>
                                <div class="width572 float borderTop">
                                    <div class="width122 float height35 borderRight">所在企业</div>
                                    <div id="companyInTable" class="height35 width449 float textCenter">郑州局集团</div>
                                </div>
                            </div>
                            <div class="floatR width125 borderLeft borderBottom" style="height: 179px;width: 125px;">
                                <br><br>照片位置（供信息管理系统用，个人不贴）
                            </div>
                            <div class="float height35 width122 borderTop">通讯地址</div>
                            <div class="float height35 width449 borderLeft borderTop">
                                <input id="addressInTable" type="text" class="height35 width449 noborder"/>
                            </div>
                            <div class="float height35 width68 borderLeft textCenter">邮编</div>
                            <div class="float height35 borderLeft" style="width: 56px">
                                <input id="mailInTable" type="text" class="height35 width56 noborder"/>
                            </div>
                            <div class="float width122 height35 borderTop">申办类别</div>
                            <div class="float height35 width575 borderTop borderLeft">
                                <input type="checkbox" id="changeCheckBox" class="float" style="margin:8px 0 0 15px"/>
                                <label for="changeCheckBox" class="float height35" style="font-size: 14px;font-family: '仿宋';">换证</label>
                                <input type="checkbox" id="fixCheckBox" class="float" style="margin: 8px 0 0 50px"/>
                                <label for="fixCheckBox" class="float height35" style="font-size: 14px;font-family: '仿宋';">补证</label>
                            </div>
                            <div class="float height54 width122 borderTop">原证准驾<br>类型</div>
                            <div class="float width449 borderTop borderLeft height54 origin">
                                <input type="checkbox" id="originJ1" class="float"/>
                                <label for="originJ1" class="float">J1</label>
                                <input type="checkbox" id="originJ2" class="float"/>
                                <label for="originJ2" class="float">J2</label>
                                <input type="checkbox" id="originJ3" class="float"/>
                                <label for="originJ3" class="float">J3</label>
                                <input type="checkbox" id="originJ4" class="float"/>
                                <label for="originJ4" class="float">J4</label>
                                <input type="checkbox" id="originJ5" class="float"/>
                                <label for="originJ5" class="float">J5</label>
                                <input type="checkbox" id="originJ6" class="float"/>
                                <label for="originJ6" class="float">J6</label><br>
                                <input type="checkbox" id="originL1" class="float"/>
                                <label for="originL1" class="float">L1</label>
                                <input type="checkbox" id="originL2" class="float"/>
                                <label for="originL2" class="float">L2</label>
                                <input type="checkbox" id="originL3" class="float"/>
                                <label for="originL3" class="float">L3</label>
                                <input type="checkbox" id="originOther" class="float"/>
                                <label for="originOther" class="float">其他（</label>
                                <input disabled type="text" id="originOtherInput" class="noborder float" style="background-color:white;height: 16px;line-height: 16px;width: 40px"/>
                                <span class="float" style="font-weight: bold">）</span>
                            </div>
                            <div class="float width125 borderLeft height54 borderTop">
                                原证发证日期：<br>
                                <span id="originYearInTable"></span>年
                                <span id="originMonthInTable"></span>月
                                <span id="originDateInTable"></span>日
                            </div>
                            <div class="float height54 width122 borderTop">申请换（补）<br>证准驾类型</div>
                            <div class="float width575 borderTop borderLeft height54 apply">
                                <input type="checkbox" id="applyJ1" class="float"/>
                                <label for="applyJ1" class="float">J1</label>
                                <input type="checkbox" id="applyJ2" class="float"/>
                                <label for="applyJ2" class="float">J2</label>
                                <input type="checkbox" id="applyJ3" class="float"/>
                                <label for="applyJ3" class="float">J3</label>
                                <input type="checkbox" id="applyJ4" class="float"/>
                                <label for="applyJ4" class="float">J4</label>
                                <input type="checkbox" id="applyJ5" class="float"/>
                                <label for="applyJ5" class="float">J5</label>
                                <input type="checkbox" id="applyJ6" class="float"/>
                                <label for="applyJ6" class="float">J6</label><br>
                                <input type="checkbox" id="applyL1" class="float"/>
                                <label for="applyL1" class="float">L1</label>
                                <input type="checkbox" id="applyL2" class="float"/>
                                <label for="applyL2" class="float">L2</label>
                                <input type="checkbox" id="applyL3" class="float"/>
                                <label for="applyL3" class="float">L3</label>
                            </div>
                            <div class="float width122 height70 borderTop">健康检查结<br>论（换证填<br>选）</div>
                            <div class="float width575 borderTop borderLeft height70 phyCheck">
                                <input type="checkbox" id="phyOk" class="float" style="margin: 29px 0 0 15px"/>
                                <label for="phyOk" class="float height70" style="line-height: 70px">合格</label>
                                <input type="checkbox" id="phyNotOk" class="float" style="margin: 29px 0 0 35px"/>
                                <label for="phyNotOk" class="float height70" style="line-height: 70px">不合格</label>
                            </div>
                            <div class="float width122 height170 borderTop" style="line-height: 150px">申请原因</div>
                            <div class="float width575 height170 borderTop borderLeft reason">
                                <div class="width575 height28">
                                    <input type="checkbox" id="reasonDeadline" class="float"/>
                                    <label for="reasonDeadline" class="float">驾驶证有效期满</label><br>
                                </div>
                                <div class="width575 height28">
                                    <input type="checkbox" id="reasonContChange" class="float fyxqmhz"/>
                                    <label for="reasonContChange" class="float">驾驶证记载内容变化</label><br>
                                </div>
                                <div class="width575 height28">
                                    <input type="checkbox" id="reasonLower" class="float fyxqmhz"/>
                                    <label for="reasonLower" class="float">本人自愿降低准驾机型</label><br>
                                </div>
                                <div class="width575 height28">
                                    <input type="checkbox" id="cardBreak" class="float"/>
                                    <label for="cardBreak" class="float">驾驶证损毁</label><br>
                                </div>
                                <div class="width575 height28">
                                    <input type="checkbox" id="cardLost" class="float"/>
                                    <label for="cardLost" class="float">驾驶证丢失</label><br>
                                </div>
                                <div class="width575 height28">
                                    <input type="checkbox" id="otherReason" class="float fyxqmhz"/>
                                    <label for="otherReason" class="float">其他说明：</label>
                                    <input disabled type="text" class="float noborder" id="otherReasonText" style="background-color: white;height: 20px;line-height: 20px;font-size: 14px;font-family: '仿宋';"/>
                                </div>

                            </div>
                            <div class="float borderTop" style="width: 100%">
                                <div class="height35" style="text-align: left;margin-bottom: 20px">
                                    本人承诺上述填报内容真实有效。若提供虚假信息，本人承担相应法律责任。
                                </div>
                                <div class="floatR height35">
                                    年&nbsp;&nbsp;&nbsp;月&nbsp;&nbsp;&nbsp;日
                                </div>
                                <div class="floatR height35" style="margin-right: 100px">
                                    申请人签名：
                                </div>
                            </div>
                            <div class="width122 float borderTop" style="height: 97px;line-height: 24px">
                                <br>所在企业<br>意&nbsp;&nbsp;&nbsp;&nbsp;见
                            </div>
                            <div class="width575 float borderTop borderLeft">
                                <div style="height: 40px;line-height: 40px;text-align: left;margin-bottom: 20px">所需证明材料齐全，并已存入个人技术档案。</div>
                                <div class="floatR">
                                    ________年_______月________日<br>
                                    （所在企业公章）
                                </div>
                                <div class="floatR" style="margin-right: 80px">
                                    主管人员签名：
                                </div>
                            </div>
                            <div class="float width122 height35 borderTop">备注</div>
                            <div class="float width575 height35 borderTop borderLeft"></div>
                        </div>
                    </div>
                    <div style="text-align: left;text-indent: 8em;font-size: 14px;font-family: '仿宋'">注：此表为A4纸格式</div>
                </div>
                <button id="applySubmit">提交</button>
                <button id="print">打印</button>
            </div>
            <div class="sjUse" id="statusContainer" style="padding-top: 50px">
                <span id="firstName"></span><span>师傅，您的驾驶证状态为：</span>
                <span id="cardStatus" style="text-decoration: underline"></span>
                <div id="alert"></div>

                <div id="applyInfo" style="margin-top: 50px;text-align: left;text-indent: 2em;padding: 90px">
                    <span id="checkStatus"></span>
                    <span id="finishStatus"></span>
                    <span id="needed"></span>
                </div>
            </div>
            <div class="sjUse" id="improveContainer">
                <div id="picContent" class="float">
                    驾驶证扫描件
                    <div id="cardPic">
                        <img id="cardPreview" width=-1 height=-1 style="display:none" />
                    </div>
                    个人照片电子档
                    <div id="photoPic">
                        <img id="photoPreview" width=-1 height=-1 style="display:none" />
                    </div>
                </div>
                <div class="float" id="formContent">
                    <form id="cardForm">
                        <div>

                            <label for="cardInput">驾驶证扫描件:</label>
                            <input type="file" name="file" id="cardInput" accept="image/*"  onchange="setCardPreview();">
                            <br><br>
                            <input type="button" name="submit" value="上传" multiple id="cardSubmit"/>

                        </div>
                    </form>
                    <form id="photoForm">
                        <div>

                            <label for="photoInput">个人照片电子档:</label>
                            <input type="file" name="file" id="photoInput" accept="image/*"  onchange="setPhotoPreview();">
                            <br><br>
                            <input type="button" name="submit" value="上传" id="photoSubmit"/>

                        </div>
                    </form>




                </div>

            </div>
        </div>
    </div>

</div>

<script type="text/javascript" src="../js/demo.js"></script>
<script type="text/javascript" src="../js/jquery-1.11.3.js"></script>
<script type="text/javascript" src="../js/jsonExportExcel.min.js"></script>
<script type="text/javascript" src="../js/xlsx.min.js"></script>
<script type="text/javascript" src="../js/base_64.js"></script>
<script type="text/javascript" src="../js/newFunc.js"></script>
<script type="text/javascript" src="../js/index1.js"></script>
<script type="text/javascript" src="../bootstrap/js/bootstrap.min.js"></script>
<script>
    //铁路局返回名单上传
    function handleFile2(e,csData) {
        var files = e.target.files;
        var i,f;
        for (i = 0, f = files[i]; i != files.length; ++i) {
            var reader = new FileReader();
            var name = f.name;
            reader.onload = function(e){
                var data = e.target.result;
                var workbook = XLSX.read(data, {type: 'binary'});
                var sheet_name_list = workbook.SheetNames;
                var result = [];
                var headItem=[];
                var dataItem=[];
                var dataFormulae=[];
                var dataCsv=[];
                var headCode=[];
                var rowNum=0;
                sheet_name_list.forEach(function(y) {
                    var worksheet = workbook.Sheets[y];
                    var json = XLSX.utils.sheet_to_json(workbook.Sheets[y]);
                    var formulae = XLSX.utils.sheet_to_formulae(workbook.Sheets[y]);
                    var csv = XLSX.utils.sheet_to_formulae(workbook.Sheets[y]);
                    if(json.length > 0){
                        result=json;
                        dataCsv=csv;
                    }
                });
                $.each(dataFormulae,function (j,head) {
                    var headlist=head.split("='")
                    if(/^[A-Z]1$/.test(headlist[0])){
                        headItem.push(headlist[1])
                    }
                })
                $.each(result,function (i,val) {
                    var data=[]
                    $.each(headItem,function (k,head) {
                        val[head]!=undefined?data.push(val[head]):data.push("")
                    })
                    dataItem.push(data)
                })
                $.each(dataCsv,function (j,head) {
                    var headlist=head.split("='")
                    rowNum=/^[A-Z]+(\d+)$/.exec(headlist[0])[1];
                    headCode.indexOf(/^([A-Z]+)\d+$/.exec(headlist[0])[1])==-1?headCode.push(/^([A-Z]+)\d+$/.exec(headlist[0])[1]):'';
                })
                headCode=headCode.sort();
                $.each(headCode,function (i,val) {
                    headItem[val]='';
                })
                for(var i=4;i<Number(rowNum)-1;i++){
                    var obj={};
                    $.each(headCode,function (i,val) {
                        obj[val]='';
                    })
                    dataItem[i]=obj;
                }
                $.each(dataCsv,function (j,head) {
                    var headRow = 5;            //此处声明一个真正表头的所在行，如果总公司返回的名单表格格式发生了变化，从这里更改
                    var headlist=head.split("='")
                    var code= /^([A-Z]+)\d+$/.exec(headlist[0])[1];
                    var row= /^[A-Z]+(\d+)$/.exec(headlist[0])[1];
                    if(row==headRow){
                        headItem[j]=headlist[1]
                    }else if(row-2>=0){
                        dataItem[row-2][code]=headlist[1];
                    }
                })
                var headstr='';
                var datastr='';
                $.each(headItem,function (i,head) {
                    if(headItem[i]){
                        headstr=headstr+'<th style="border: 1px solid #cccccc">'+head+'</th>'
                    }
                })
                $.each(dataItem,function (i,data) {
                    datastr=datastr+'<tr >';
                    var clasS = '';
                    $.each(data,function (j,val) {
                        switch (j){
                            //按照总公司返回的《XXX等N名取得铁路机车车辆驾驶资格人员名单》（文件名一般是PO+时间戳），把每一列和类名意义对应
                            case 'A':clasS = 'number';
                                break;
                            case 'B':clasS = 'uName';
                                break;
                            case 'C':clasS = 'sex';
                                break;
                            case 'D':clasS = 'cardId';
                                break;
                            case 'E':clasS = 'unit';
                                break;
                            case 'F':clasS = 'sjDriveCode';
                                break;
                            case 'G':clasS = 'startDate';
                                break;
                            case 'H':clasS = 'deadline';
                                break;
                        }
                        datastr=datastr+'<td style="border: 1px solid #cccccc" class="'+clasS+'">'+val+'</td>'
                    })
                    datastr=datastr+'</tr>';
                })
                var table='<table style="border: 1px solid #cccccc;border-collapse: collapse;"><thead><tr style="font-weight: bold">'+headstr+'</tr></thead><tbody>'+datastr+ '</tbody></table>'

                var _alert = '<div style="padding:10px 0;text-align: center;font-weight:bold;color:red">请逐条确认信息是否有误，确认无误后<br>请点击该条目以将该信息加入系统</div>'
                $('#uploadContent2').empty().html(_alert+$('#uploadContent2').html()+table);
                var unit = '中国铁路郑州局集团有限公司洛阳机务段';        //单位名
                $.each($("#uploadContent2 table tr .unit"),function(m,val){
                    if($(val).text() === unit){

                    }else{
                        $(val).parent().remove()
                    }
                })
                $.each($("#uploadContent2 table tr .number"),function(m,val){
                    $(this).text($(this).parent().index()-3)
                })
                $('#appendPage').css('display','none');
                $('#appendTSTable').css('display','none');
                alert('请点选我段人员')

                //取参数表
                $.ajax({
                    url: "../../../ways.php",
                    type: "POST",
                    timeout: 8000,
                    data: {
                        funcName: 'getCsxx', serverName: '10.101.62.73', uid: 'sa', pwd: '2huj15h1', Database: 'JSZGL',
                        tableName: 'csxx', column: '*'
                    },
                    dataType: 'json',
                    success: function (csData) {
                        appendJbxx(csData)

                    }
                })

                //等待结果页签，点选总公司返回的名单，把此人信息加入jbxx表
                function appendJbxx(csData){
                    $("#uploadContent2 table tbody tr").off('click').on('click',function(){
                        var _this = $(this);
                        var uname = $(this).find('.uName').text()
                        var sex = $(this).find('.sex').text()
                        var sjDriveCode = $(this).find('.sjDriveCode').text();
                        var sjDriveType = csData['zjlx-'+sjDriveCode]['nr1'];

                        function dotTo(str){
                            //该函数接收一个'xxxx.x.xx'格式的日期，返回一个'xxxx-xx-xx'格式
                            var strArr = str.split('.');
                            if(strArr[1].length<2){
                                strArr[1] = '0'+strArr[1];
                            }
                            if(strArr[2].length<2){
                                strArr[2] = '0'+strArr[2];
                            }
                            var _newStr = strArr[0]+'-'+strArr[1]+'-'+strArr[2]
                            return _newStr
                        }
                        var startDate = dotTo($(this).find('.startDate').text());//提升司机人员，有效起始日期和领证日期一样
                        var sjDate = dotTo($(this).find('.startDate').text());
                        var deadline = dotTo($(this).find('.deadline').text())
                        $.ajax({
                            url: "../../../ways.php",
                            type: "POST",
                            timeout: 8000,
                            data: {
                                funcName: 'checkIfExist',
                                serverName: '10.101.62.73',
                                uid: 'sa',
                                pwd: '2huj15h1',
                                Database: 'JSZGL',
                                tableName: 'dbsx',
                                column: ' *',
                                where: ' where uname = \'' + uname + '\' AND type = \'副司机升司机\'' ,
                                order: ' '
                            },
                            dataType: 'json',
                            success:function(data){
                                console.log(data)
                                if(data['rows'] === 1){
                                    //最正常情况，找到此人并无重名
                                    //从dbsx中取到该条完整数据，并插入jbxx，成功后在dbsx中删除该条,还要更新tjxx
                                    var column = '*';
                                    $.ajax({
                                        url: "../../../ways.php",
                                        type:"POST",
                                        timeout:8000,
                                        //若后期连接数据库的接口需求有变化，需要从这里更改数据的键值
                                        data:{funcName:'select',where:' where uname =\''+uname+'\'',serverName:'10.101.62.73',uid:'sa',pwd:'2huj15h1',Database:'JSZGL',
                                            tableName:' dbsx ',column:column,order:' '},
                                        dataType:'json',
                                        success:function(data){
                                            var payId = data['row1']['payId'];
                                            var archivesId = data['row1']['archivesId'];
                                            var UName = data['row1']['UName'];
                                            var birthDate = data['row1']['birthDate'];
                                            var cardId = data['row1']['cardId'];
                                            var department = data['row1']['Department'];
                                            if(department.indexOf('运用') >= 0){
                                                department += ',运用系统'
                                            }else if(department.indexOf('整备') >= 0){
                                                department += ',整备系统'
                                            }
                                            var txrq = data['row1']['txrq'];
                                            var status = csData['zjzt-zc']['nr2'];
                                            var tzDone = csData['tzDone-swtz']['nr2'];
                                            var phyTest = csData['tjjl-hg']['nr2']

                                            //这次请求是验证库内是否已经有这个档案号（主键），有的话update否则insert
                                            $.ajax({
                                                url: "../../../ways.php",
                                                type:"POST",
                                                timeout:8000,
                                                //若后期连接数据库的接口需求有变化，需要从这里更改数据的键值
                                                data:{funcName:'select',where:' where archivesId =\''+archivesId+'\'',serverName:'10.101.62.73',uid:'sa',pwd:'2huj15h1',Database:'JSZGL',
                                                    tableName:' jbxx ',column:' archivesId',order:' '},
                                                dataType:'json',
                                                success:function(data){
                                                    if(data['success'] === 0){
                                                        //insert
                                                        $.ajax({
                                                            url: "../../../ways.php",
                                                            type: "POST",
                                                            timeout: 8000,
                                                            data: {
                                                                funcName: 'insert',
                                                                serverName: '10.101.62.73',
                                                                uid: 'sa',
                                                                pwd: '2huj15h1',
                                                                Database: 'jszgl',
                                                                tableName: ' jbxx',
                                                                column: ' (payId,archivesId,UName,sex,department,birthDate,txrq,cardId,sjDate,' +
                                                                'startdate,deadline,sjDriveCode,sjDriveType,status,tzdone,phyTest)',
                                                                values: '(\''+payId+'\',\'' + archivesId + '\',\'' + UName + '\',\'' + sex + '\',\'' + department + '\',\'' + birthDate + '\',\'' + txrq + '\',\'' + cardId + '\',\''
                                                                + sjDate + '\',\'' + startDate + '\',\'' + deadline + '\',\'' + sjDriveCode + '\',\'' + sjDriveType + '\',\'' + status + '\',\''+tzDone+'\',\''+phyTest+'\')'
                                                            },
                                                            dataType: 'json',
                                                            success: function (){
                                                                alert('添加成功')
                                                                _this.remove()
                                                                $.each($("#uploadContent2 table tr .number"),function(m,val){
                                                                    $(this).text($(this).parent().index()-3)
                                                                })
                                                                //插入bgxx
                                                                var date = new Date();
                                                                var year = date.getFullYear()
                                                                var lotNumber = new Date();
                                                                lotNumber.month = lotNumber.getMonth() < 9 ? '0' + (lotNumber.getMonth() + 1) : lotNumber.getMonth() + 1;
                                                                lotNumber.date = lotNumber.getDate() < 10 ? '0' + lotNumber.getDate() : lotNumber.getDate();
                                                                lotNumber = lotNumber.getFullYear() + '-' + lotNumber.month + '-' + lotNumber.date;
                                                                $.ajax({
                                                                    url: "../../../ways.php",
                                                                    type: "POST",
                                                                    timeout: 8000,
                                                                    data: {
                                                                        funcName: 'insert',
                                                                        serverName: '10.101.62.73',
                                                                        uid: 'sa',
                                                                        pwd: '2huj15h1',
                                                                        Database: 'jszgl',
                                                                        tableName: ' bgxx',
                                                                        column: ' (id,lotNumber,Department,payId,archivesId,UName,changeType,' +
                                                                        'driveCode,drive,jykOperator)',
                                                                        values: '(getDate(),\'' + lotNumber + '\',\'' + department + '\',\'' + payId + '\',\'' + archivesId + '\',\'' + uname + '\',\'' + csData['czlb-levelup2']['nr2']  +
                                                                        '\',\'' + sjDriveCode +  '\',\'' + sjDriveType + '\',\'' + sessionGet('user') + '\')'
                                                                    },
                                                                    dataType: 'json',
                                                                    success: function (ret) {
                                                                    }
                                                                })
                                                                //删除DBSX表中数据
                                                                $.ajax({
                                                                    url: "../../../ways.php",
                                                                    type: "POST",
                                                                    timeout: 8000,
                                                                    data: {
                                                                        funcName: 'delete',
                                                                        serverName: '10.101.62.73',
                                                                        uid: 'sa',
                                                                        pwd: '2huj15h1',
                                                                        Database: 'jszgl',
                                                                        tableName: ' dbsx',
                                                                        where: ' where archivesId =\'' + archivesId + '\''
                                                                    },
                                                                    dataType: 'json',
                                                                    success:function(data){

                                                                    }
                                                                })
                                                                //更新tjxx表
                                                                var setStr1 = 'increaseAmount = increaseAmount + 1,kshg=kshg+1,yearlyAmount = yearlyAmount+1';
                                                                var where1 =  ' where driveCode = \''+ sjDriveCode +'\' AND year = '+year;
                                                                $.ajax({
                                                                    url: "../../../ways.php",
                                                                    type: "POST",
                                                                    timeout: 8000,
                                                                    data: {
                                                                        funcName: 'update',
                                                                        serverName: '10.101.62.73',
                                                                        uid: 'sa',
                                                                        pwd: '2huj15h1',
                                                                        Database: 'jszgl',
                                                                        tableName: ' tjxx',
                                                                        setStr: setStr1,
                                                                        where: where1
                                                                    },
                                                                    dataType: 'json',
                                                                    success: function () {

                                                                    }
                                                                })
                                                            }
                                                        })
                                                    }else{
                                                        //update
                                                        var columnArr = ['payId','UName','department','cardId','sex','birthDate','txrq','sjDate','startDate','deadline','sjDriveCode','sjDriveType','status','tzDone','phyTest'];
                                                        var valuesArr = [payId,UName,department,cardId,sex,birthDate,txrq,sjDate,startDate,deadline,sjDriveCode,sjDriveType,status,tzDone,phyTest];
                                                        var setStr = '';
                                                        for (var i = 0; i < columnArr.length; i++) {
                                                            setStr += columnArr[i] + '=' + '\'' + valuesArr[i] + '\'' + ','
                                                        }
                                                        //该变量是update语句中set后面的句段
                                                        setStr = setStr.substring(0, setStr.length - 1);
                                                        $.ajax({
                                                            url: "../../../ways.php",
                                                            type: "POST",
                                                            timeout: 8000,
                                                            data: {
                                                                funcName: 'update', serverName: '10.101.62.73', uid: 'sa', pwd: '2huj15h1', Database: 'jszgl',
                                                                tableName: ' jbxx', setStr: setStr, where: ' where archivesId = \''+archivesId+'\''
                                                            },
                                                            dataType: 'json',
                                                            success: function () {
                                                                alert('添加完成')
                                                                _this.remove()
                                                                $.each($("#uploadContent2 table tr .number"),function(m,val){
                                                                    $(this).text($(this).parent().index()-3)
                                                                })
                                                                //删除DBSX表中数据
                                                                $.ajax({
                                                                    url: "../../../ways.php",
                                                                    type: "POST",
                                                                    timeout: 8000,
                                                                    data: {
                                                                        funcName: 'delete',
                                                                        serverName: '10.101.62.73',
                                                                        uid: 'sa',
                                                                        pwd: '2huj15h1',
                                                                        Database: 'jszgl',
                                                                        tableName: ' dbsx',
                                                                        where: ' where archivesId =\'' + archivesId + '\''
                                                                    },
                                                                    dataType: 'json',
                                                                    success:function(data){

                                                                    }
                                                                })
                                                                //更新tjxx表
                                                                var date = new Date();
                                                                var year = date.getFullYear()
                                                                var setStr1 = 'increaseAmount = increaseAmount + 1,kshg=kshg+1,yearlyAmount = yearlyAmount+1';
                                                                var where1 =  ' where driveCode = \''+ sjDriveCode +'\' AND year = '+year;
                                                                $.ajax({
                                                                    url: "../../../ways.php",
                                                                    type: "POST",
                                                                    timeout: 8000,
                                                                    data: {
                                                                        funcName: 'update',
                                                                        serverName: '10.101.62.73',
                                                                        uid: 'sa',
                                                                        pwd: '2huj15h1',
                                                                        Database: 'jszgl',
                                                                        tableName: ' tjxx',
                                                                        setStr: setStr1,
                                                                        where: where1
                                                                    },
                                                                    dataType: 'json',
                                                                    success: function () {

                                                                    }
                                                                })
                                                            }
                                                        })
                                                    }
                                                }
                                            })


                                        }
                                    })
                                }else if(data['rows'] > 1){
                                    //找到此人并且有重名情况
                                    var top = document.documentElement.scrollTop;

                                    $('#appendWindowContent').css({'visibility':'visible','opacity':'0.9'})
                                    $('#appendWindow').css('top',top+'px')
                                    column = ' payId,archivesId,department,uName,cardId'
                                    $.ajax({
                                        url: "../../../ways.php",
                                        type:"POST",
                                        timeout:8000,
                                        //若后期连接数据库的接口需求有变化，需要从这里更改数据的键值
                                        data:{funcName:'select',where:' where uname =\''+uname+'\'',serverName:'10.101.62.73',uid:'sa',pwd:'2huj15h1',Database:'JSZGL',
                                            tableName:' dbsx ',column:column,order:' '},
                                        dataType:'json',
                                        success:function(data){
                                            var count = data['count'];
                                            delete data['count']
                                            delete data['success']
                                            var html ='<table cellpadding="0" cellspacing="0">';
                                            html+='<tr>'
                                            html+='<th>选择</th>'
                                            for(var m in data['row1']){
                                                var n = '';
                                                switch(m){
                                                    case 'payId':
                                                        n = '工资号';
                                                        break;
                                                    case 'archivesId':
                                                        n = '档案号';
                                                        break;
                                                    case 'uName':
                                                        n = '姓名';
                                                        break;
                                                    case 'cardId':
                                                        n = '身份证号';
                                                        break;
                                                    case 'department':
                                                        n = '部门';
                                                        break;
                                                }
                                                html+='<th>'+ n +'</th>'
                                            }
                                            html+='</tr>'
                                            for(var i in data){
                                                html+='<tr>'
                                                html+='<td><input type="radio" name="appendRadio" class="appendRadio" value="'+i+'"></td>'
                                                for(var j in data[i]){
                                                    html+='<td>'+ data[i][j] +'</td>'
                                                }
                                                html+='</tr>'
                                            }
                                            html+='</table>';
                                            $('.appendWindowArea').empty().append(html);
                                            $('.appendButtonArea .submit').off('click').on('click',function(){
                                                var flag = $('.appendWindowArea table td .appendRadio:checked').val()
                                                if(!flag){
                                                    alert('请选择正确的人员。或者点击‘取消’')
                                                }else{
                                                    console.log($('.appendWindowArea table td .appendRadio:checked').parent().parent().index())
                                                    var payId = data[flag]['payId'];
                                                    column = ' *'
                                                    //数据对应，写入jbxx表
                                                    $.ajax({
                                                        url: "../../../ways.php",
                                                        type:"POST",
                                                        timeout:8000,
                                                        //若后期连接数据库的接口需求有变化，需要从这里更改数据的键值
                                                        data:{funcName:'select',where:' where payid =\''+payId+'\'',serverName:'10.101.62.73',uid:'sa',pwd:'2huj15h1',Database:'JSZGL',
                                                            tableName:' dbsx ',column:column,order:' '},
                                                        dataType:'json',
                                                        success:function(data){
                                                            data['sjDate'] = sjDate;
                                                            data['sjDriveCode'] = sjDriveCode;
                                                            data['sjDrive'] = sjDriveType;
                                                            data['sex'] = sex;
                                                            var payId = data['row1']['payId'];
                                                            var archivesId = data['row1']['archivesId'];
                                                            var UName = data['row1']['UName'];
                                                            var birthDate = data['row1']['birthDate'];
                                                            var cardId = data['row1']['cardId'];
                                                            var department = data['row1']['Department'];
                                                            if(department.indexOf('运用') >= 0){
                                                                department += ',运用系统'
                                                            }else if(department.indexOf('整备') >= 0){
                                                                department += ',整备系统'
                                                            }
                                                            var txrq = data['row1']['txrq'];
                                                            var status = csData['zjzt-zc']['nr2'];
                                                            var tzDone = csData['tzDone-swtz']['nr2'];
                                                            var phyTest = csData['tjjl-hg']['nr2']
                                                            $.ajax({
                                                                    url: "../../../ways.php",
                                                                    type: "POST",
                                                                    timeout: 8000,
                                                                    data: {
                                                                        funcName: 'insert',
                                                                        serverName: '10.101.62.73',
                                                                        uid: 'sa',
                                                                        pwd: '2huj15h1',
                                                                        Database: 'jszgl',
                                                                        tableName: ' jbxx',
                                                                        column: ' (payId,archivesId,UName,sex,department,birthDate,txrq,cardId,sjDate,' +
                                                                        'startdate,deadline,sjDriveCode,sjDriveType,status,tzdone,phyTest)',
                                                                        values: '(\''+payId+'\',\'' + archivesId + '\',\'' + UName + '\',\'' + sex + '\',\'' + department + '\',\'' + birthDate + '\',\'' + txrq + '\',\'' + cardId + '\',\''
                                                                        + sjDate + '\',\'' + startDate + '\',\'' + deadline + '\',\'' + sjDriveCode + '\',\'' + sjDriveType + '\',\'' + status + '\',\''+tzDone+'\',\''+phyTest+'\')'
                                                                    },
                                                                    dataType: 'json',
                                                                    success: function (){
                                                                        $('#appendWindowContent').css({'visibility':'hidden','opacity':'0'})
                                                                        alert('添加完成')
                                                                        _this.remove()
                                                                        $.each($("#uploadContent2 table tr .number"),function(m,val){
                                                                            $(this).text($(this).parent().index()-3)
                                                                        })
                                                                        //删除DBSX表中数据
                                                                        $.ajax({
                                                                            url: "../../../ways.php",
                                                                            type: "POST",
                                                                            timeout: 8000,
                                                                            data: {
                                                                                funcName: 'delete',
                                                                                serverName: '10.101.62.73',
                                                                                uid: 'sa',
                                                                                pwd: '2huj15h1',
                                                                                Database: 'jszgl',
                                                                                tableName: ' dbsx',
                                                                                where: ' where archivesId =\'' + archivesId + '\''
                                                                            },
                                                                            dataType: 'json',
                                                                            success:function(data){

                                                                            }
                                                                        })
                                                                        //更新tjxx表
                                                                        var date = new Date();
                                                                        var year = date.getFullYear()
                                                                        var setStr1 = 'increaseAmount = increaseAmount + 1,kshg=kshg+1,yearlyAmount = yearlyAmount+1';
                                                                        var where1 =  ' where driveCode = \''+ sjDriveCode +'\' AND year = '+year;
                                                                        $.ajax({
                                                                            url: "../../../ways.php",
                                                                            type: "POST",
                                                                            timeout: 8000,
                                                                            data: {
                                                                                funcName: 'update',
                                                                                serverName: '10.101.62.73',
                                                                                uid: 'sa',
                                                                                pwd: '2huj15h1',
                                                                                Database: 'jszgl',
                                                                                tableName: ' tjxx',
                                                                                setStr: setStr1,
                                                                                where: where1
                                                                            },
                                                                            dataType: 'json',
                                                                            success: function () {

                                                                            }
                                                                        })
                                                                    }
                                                                })
                                                        }
                                                    })

                                                }

                                            })
                                            $('.appendButtonArea .cancel').off('click').on('click',function(){
                                                $('#appendWindowContent').css({'visibility':'hidden','opacity':'0'})
                                            })

                                            //
                                            // var archivesId = data['row1']['archivesId'];
                                            // var UName = data['row1']['UName'];
                                            // var birthDate = data['row1']['birthDate'];
                                            // var cardId = data['row1']['cardId'];
                                            // var department = data['row1']['Department'];
                                            // var txrq = data['row1']['txrq'];
                                            // var status = csData['zjzt-zc']['nr2'];
                                            // var tzDone = csData['tzDone-swtz']['nr2'];
                                            // var phyTest = csData['tjjl-hg']['nr2']
                                            // $.ajax({
                                            //     url: "../../../ways.php",
                                            //     type: "POST",
                                            //     timeout: 8000,
                                            //     data: {
                                            //         funcName: 'insert',
                                            //         serverName: '10.101.62.73',
                                            //         uid: 'sa',
                                            //         pwd: '2huj15h1',
                                            //         Database: 'jszgl',
                                            //         tableName: ' jbxx',
                                            //         column: ' (payId,archivesId,UName,sex,department,birthDate,txrq,cardId,sjDate,' +
                                            //         'startdate,deadline,sjDriveCode,sjDriveType,status,tzdone,phyTest)',
                                            //         values: '(\''+payId+'\',\'' + archivesId + '\',\'' + UName + '\',\'' + sex + '\',\'' + department + '\',\'' + birthDate + '\',\'' + txrq + '\',\'' + cardId + '\',\''
                                            //         + sjDate + '\',\'' + startDate + '\',\'' + deadline + '\',\'' + sjDriveCode + '\',\'' + sjDriveType + '\',\'' + status + '\',\''+tzDone+'\',\''+phyTest+'\')'
                                            //     },
                                            //     dataType: 'json',
                                            //     success: function (){
                                            //
                                            //     }
                                            // })
                                        }
                                    })
                                }else if(data['success'] === 0){
                                    alert('查无此人');
                                }
                            }
                        })
                    })
                }
            };
            reader.readAsBinaryString(f);
        }
        $('#uploadExcel2').val('')
    }
    $('#uploadExcel2').bind('change', handleFile2);
</script>
</body>
</html>